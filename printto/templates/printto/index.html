{% extends "printto/base.html" %}

{% load static %}
{% load sass_tags %}

{% block title %}PrintTo{% endblock title %}

{% block head %}
<link href='{% static "dropzonejs/5.2.0/css/basic.min.css" %}' rel="stylesheet">
<link href='{% static "dropzonejs/5.2.0/css/dropzone.min.css" %}' rel="stylesheet">
<script src='{% static "dropzonejs/5.2.0/js/dropzone.min.js" %}'></script>

<script>

$(document).ready(function(){
    // Dropzone configurations
    Dropzone.options.printerDropzone = {
        paramName: "file", // The name that will be used to transfer the file
        maxFilesize: 100, // MB
        acceptedFiles: "application/pdf",
        addRemoveLinks: true,
        parallelUploads: 1,
        createImageThumbnails: false,
        autoProcessQueue: false,
        accept: function(file, done) {
            fileExt = file.name.split('.').pop();
            if ((fileExt != "pdf") && (fileExt != "PDF")) {
                done("Unsupported file type!");
            } else {
                done();
            }
        },
        dictDefaultMessage: "<h3><strong>Click here or drop files here to upload!</strong><h3>"
    };
});

function resetAutoProcessQueueOption() {
    printerDropzone = Dropzone.forElement("#printerDropzone");
    printerDropzone.options.autoProcessQueue = false;
};

function startUpload() {
    printerDropzone = Dropzone.forElement("#printerDropzone");

    // Disable queue auto processing on upload complete
    printerDropzone.on("queuecomplete", resetAutoProcessQueueOption);
    printerDropzone.options.autoProcessQueue = true;
    printerDropzone.processQueue();
};
</script>
{% endblock%}

{% block content %}
<div class="container">
    <div class="row">
        <button class="btn btn-primary start" onclick="startUpload()">
            <i class="glyphicon glyphicon-upload"></i> <span>Start Print</span>
        </button>
    </div>
    <h4>Queued documents:</h4>
    <form id="printerDropzone"
        action='{% url "index" %}'
        enctype="multipart/form-data"
        method="post"
        class="dropzone">
        {% csrf_token %}
    </form>
</div>
{% endblock content %}

